<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Editor de Firma</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="/public/Main/M-styles/sign.css">
</head>
<body>

  <!-- Barra superior -->
  <div class="bar">
    <strong>Prueba</strong>
    <div class="actions">
      <button class="chip">FIRMA T√ö MISMO</button>
      <button id="sendBtn" class="chip"> ENVIAR</button>
      <button id="saveBtn" class="chip primary"> GUARDAR</button>
    </div>
  </div>

  <div class="layout">
    <!-- IZQUIERDA -->
    <aside class="panel left">
      <div class="thumb"></div>
      <div id="docInfo" class="doc-info">
        <div class="doc-name">Sin documento</div>
        <div class="doc-meta">Sube un PDF para comenzar</div>
      </div>

      <div class="upload">
        <label class="chip" for="pdfFile">‚¨ÜÔ∏è SUBIR PDF</label>
        <input id="pdfFile" type="file" accept="application/pdf,.pdf" />
      </div>
    </aside>

    <!-- CENTRO -->
    <main class="panel" style="overflow:auto">
      <div class="canvas-wrap" id="pageWrap" aria-label="P√°gina PDF">
        <canvas id="pdfCanvas"></canvas>
        <div id="overlay"></div>
      </div>
    </main>

    <!-- DERECHA -->
    <aside class="panel">
      <h4 style="margin:6px 0 10px">Primera Parte</h4>
      <div id="toolSign" class="tool">‚úçÔ∏è <div>Firma</div></div>
      <div id="toolText" class="tool">üî§ <div>Texto</div></div>
      <div id="toolDate" class="tool">üìÖ <div>Fecha</div></div>

      <ul class="tips">
        <li>Selecciona una herramienta y haz clic en el PDF para colocar campos.</li>
        <li>Luego pulsa <b>Guardar</b> para generar el PDF.</li>
      </ul>
    </aside>
  </div>

  <!-- MODAL de firma -->
  <div id="sigModal" class="modal-back" aria-hidden="true">
    <div class="modal modal-signature" role="dialog" aria-modal="true">
      <div class="modal-header">
        <h3>‚úçÔ∏è Firma Digital</h3>
        <button class="close-modal" id="sigClose">√ó</button>
      </div>
      <div class="modal-body">
        <label class="input-label">Dibuja tu firma con el mouse o pantalla t√°ctil</label>
        <div class="sig-wrap"><canvas id="sigPad"></canvas></div>
      </div>
      <div class="modal-footer">
        <button id="sigClear" class="btn btn-secondary">üóëÔ∏è Limpiar</button>
        <button id="sigCancel" class="btn btn-secondary">Cancelar</button>
        <button id="sigOk" class="btn btn-primary">‚úì Usar firma</button>
      </div>
    </div>
  </div>

  <!-- MODAL de texto -->
  <div id="textModal" class="modal-back" aria-hidden="true">
    <div class="modal modal-text" role="dialog" aria-modal="true">
      <div class="modal-header">
        <h3>‚úçÔ∏è Personalizar Texto</h3>
        <button class="close-modal" id="textClose">√ó</button>
      </div>
      
      <div class="modal-body">
        <div class="text-input-section">
          <label class="input-label">Contenido</label>
          <textarea id="textInput" class="text-area" placeholder="Escribe tu texto aqu√≠..." rows="3"></textarea>
        </div>
        
        <div class="format-toolbar">
          <!-- Fila 1: Fuente y Tama√±o -->
          <div class="toolbar-row">
            <div class="toolbar-group">
              <label class="toolbar-label">Fuente</label>
              <select id="fontFamily" class="toolbar-select font-select">
                <option value="Arial">Arial</option>
                <option value="Helvetica">Helvetica</option>
                <option value="Times New Roman">Times New Roman</option>
                <option value="Courier New">Courier New</option>
                <option value="Georgia">Georgia</option>
                <option value="Verdana">Verdana</option>
                <option value="Calibri">Calibri</option>
                <option value="Cambria">Cambria</option>
              </select>
            </div>
            
            <div class="toolbar-group">
              <label class="toolbar-label">Tama√±o</label>
              <select id="fontSize" class="toolbar-select size-select">
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
                <option value="11">11</option>
                <option value="12" selected>12</option>
                <option value="14">14</option>
                <option value="16">16</option>
                <option value="18">18</option>
                <option value="20">20</option>
                <option value="22">22</option>
                <option value="24">24</option>
                <option value="28">28</option>
                <option value="32">32</option>
              </select>
            </div>
            
            <div class="toolbar-group">
              <label class="toolbar-label">Color</label>
              <div class="color-picker-wrapper">
                <input type="color" id="fontColor" class="color-input" value="#000000">
                <span class="color-preview" id="colorPreview"></span>
              </div>
            </div>
          </div>
          
          <!-- Fila 2: Estilos y Alineaci√≥n -->
          <div class="toolbar-row">
            <div class="toolbar-group">
              <label class="toolbar-label">Formato</label>
              <div class="format-buttons">
                <button type="button" id="boldBtn" class="format-btn" title="Negrita (Ctrl+B)">
                  <strong>B</strong>
                </button>
                <button type="button" id="italicBtn" class="format-btn" title="Cursiva (Ctrl+I)">
                  <em>I</em>
                </button>
                <button type="button" id="underlineBtn" class="format-btn" title="Subrayado (Ctrl+U)">
                  <u>U</u>
                </button>
              </div>
            </div>
            
            <div class="toolbar-group">
              <label class="toolbar-label">Alineaci√≥n</label>
              <div class="format-buttons">
                <button type="button" id="alignLeft" class="format-btn active" data-align="left" title="Alinear izquierda">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                    <path d="M2 3h12v2H2V3zm0 4h8v2H2V7zm0 4h12v2H2v-2z"/>
                  </svg>
                </button>
                <button type="button" id="alignCenter" class="format-btn" data-align="center" title="Centrar">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                    <path d="M4 3h8v2H4V3zm2 4h4v2H6V7zm-2 4h8v2H4v-2z"/>
                  </svg>
                </button>
                <button type="button" id="alignRight" class="format-btn" data-align="right" title="Alinear derecha">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                    <path d="M2 3h12v2H2V3zm4 4h8v2H6V7zm-4 4h12v2H2v-2z"/>
                  </svg>
                </button>
              </div>
            </div>
          </div>
        </div>
        
        <div class="preview-section">
          <label class="input-label">Vista previa</label>
          <div id="textPreview" class="text-preview">Tu texto aparecer√° aqu√≠...</div>
        </div>
      </div>
      
      <div class="modal-footer">
        <button id="textCancel" class="btn btn-secondary">Cancelar</button>
        <button id="textOk" class="btn btn-primary">‚úì Aplicar</button>
      </div>
    </div>
  </div>

  <!-- MODAL de fecha -->
  <div id="dateModal" class="modal-back" aria-hidden="true">
    <div class="modal modal-date" role="dialog" aria-modal="true">
      <div class="modal-header">
        <h3>üìÖ Seleccionar Fecha</h3>
        <button class="close-modal" id="dateClose">√ó</button>
      </div>
      <div class="modal-body">
        <label class="input-label">Fecha del documento</label>
        <input type="date" id="dateInput" class="date-input">
      </div>
      <div class="modal-footer">
        <button id="dateCancel" class="btn btn-secondary">Cancelar</button>
        <button id="dateOk" class="btn btn-primary">‚úì Agregar fecha</button>
      </div>
    </div>
  </div>

  <!-- MODAL de destinatarios -->
  <div id="recipientsModal" class="modal-back" aria-hidden="true">
    <div class="modal modal-recipients" role="dialog" aria-modal="true">
      <div class="modal-header">
        <h3>Agregar nuevos destinatarios</h3>
        <button class="close-modal" id="recipientsClose">√ó</button>
      </div>

      <div class="modal-body">
        <!-- Pesta√±as -->
        <div class="recipients-tabs">
          <button class="recipients-tab active" data-tab="email">por Email</button>
          <button class="recipients-tab" data-tab="phone">por Tel√©fono</button>
          <button class="recipients-tab" data-tab="detailed">Detallado</button>
          <button class="recipients-tab" data-tab="upload">Subir lista</button>
        </div>

        <!-- Contenido de pesta√±as -->
        <div class="recipients-content">
          <!-- Pesta√±a Email -->
          <div id="tab-email" class="tab-content active">
            <textarea
              id="emailInput"
              class="recipients-textarea"
              placeholder="Escribe correos electr√≥nicos aqu√≠..."
              rows="6"
            ></textarea>
          </div>

          <!-- Pesta√±a Tel√©fono -->
          <div id="tab-phone" class="tab-content">
            <textarea
              id="phoneInput"
              class="recipients-textarea"
              placeholder="Escribe n√∫meros de tel√©fono aqu√≠..."
              rows="6"
            ></textarea>
          </div>

          <!-- Pesta√±a Detallado -->
          <div id="tab-detailed" class="tab-content">
            <div class="detailed-form">
              <input type="text" class="form-input" placeholder="Nombre completo">
              <input type="email" class="form-input" placeholder="Correo electr√≥nico">
              <input type="tel" class="form-input" placeholder="Tel√©fono (opcional)">
            </div>
          </div>

          <!-- Pesta√±a Subir lista -->
          <div id="tab-upload" class="tab-content">
            <div class="upload-zone">
              <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="17 8 12 3 7 8"/>
                <line x1="12" y1="3" x2="12" y2="15"/>
              </svg>
              <p>Arrastra un archivo CSV o haz clic para seleccionar</p>
              <input type="file" id="csvFileInput" accept=".csv" style="display:none">
              <button class="upload-btn" onclick="document.getElementById('csvFileInput').click()">Seleccionar archivo</button>
            </div>
          </div>
        </div>

        <!-- Checkbox y opciones -->
        <div class="recipients-options">
          <label class="checkbox-label">
            <input type="checkbox" id="sendEmailCheckbox" checked>
            <span>Enviar correo electr√≥nico</span>
          </label>
          <a href="#" class="edit-message-link" id="editMessageLink">Editar mensaje</a>
        </div>
      </div>

      <div class="modal-footer">
        <button id="recipientsCancel" class="btn btn-secondary">Cancelar</button>
        <button id="recipientsAdd" class="btn btn-primary">AGREGAR DESTINATARIOS</button>
      </div>
    </div>
  </div>

  <!-- Libs desde UNPKG (alternativa a CDNJS) -->
  <script src="https://unpkg.com/pdfjs-dist@4.0.379/build/pdf.min.mjs" type="module"></script>
  <script type="module">
    // Importar PDF.js como m√≥dulo
    import * as pdfjsLib from 'https://unpkg.com/pdfjs-dist@4.0.379/build/pdf.min.mjs';
    
    // Configurar worker
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://unpkg.com/pdfjs-dist@4.0.379/build/pdf.worker.min.mjs';
    
    // Hacer disponible globalmente
    window.pdfjsLib = pdfjsLib;
    console.log('‚úÖ PDF.js cargado correctamente desde UNPKG');
    console.log('ÔøΩ pdfjsLib disponible:', window.pdfjsLib);
  </script>
  
  <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
  <script>
    setTimeout(function() {
      if (typeof PDFLib !== 'undefined') {
        console.log('‚úÖ pdf-lib cargado correctamente');
      } else {
        console.error('‚ùå pdf-lib no se carg√≥');
      }
    }, 100);
  </script>

  <!-- Tu JS - versi√≥n corregida -->
  <script src="/public/Main/sign.js"></script>
</body>
</html>
